"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const wasm_1 = require("../wasm");
const util_1 = require("./util");
/* eslint-disable @typescript-eslint/no-explicit-any,@typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-return */
// This can't panic / throw exceptions. Any panic here should be considered a
// bug to be fixed. prisma-fmt will return an empty CompletionList on error.
function textDocumentCompletion(schema, params, onError) {
    // CompletionParams.textDocument doesn't match the Language Server JSON-RPC protocol
    // as defined by the spec. In the spec, it is an object with one property:
    // uri, which is a string. The above `params` are a structured object with
    // methods, and `__uri` and `__contents` properties.
    //
    // prisma-fmt expects something spec-compliant, so we enforce this here.
    const correctParams = params;
    correctParams['textDocument'] = { uri: 'file:/dev/null' };
    const stringifiedParams = JSON.stringify(correctParams);
    try {
        if (process.env.FORCE_PANIC_PRISMA_FMT) {
            (0, util_1.handleFormatPanic)(() => {
                console.debug('Triggering a Rust panic...');
                wasm_1.prismaFmt.debug_panic();
            });
        }
        const response = wasm_1.prismaFmt.text_document_completion(schema, stringifiedParams);
        return JSON.parse(response);
    }
    catch (e) {
        const err = e;
        (0, util_1.handleWasmError)(err, 'text_document_completion', onError);
        return {
            isIncomplete: true,
            items: [],
        };
    }
}
exports.default = textDocumentCompletion;
//# sourceMappingURL=textDocumentCompletion.js.map